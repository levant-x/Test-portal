@using Portal.Models
@{
  const string LOGIN_VID = "login";
  const string REG_VID = "reg";
}

<!DOCTYPE html>
<html lang="ru">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <title>Портал по олимпиаде</title>
</head>
<body> 
  <div class="min-vh-100 d-flex flex-column justify-content-center">
    <div class="container col-sm-10 col-lg-5">

      @* TODO conditional if not authenticated, else PROFILE *@

      @await Html.PartialAsync("_GenericForm", new FormVM()
      {
        Item = (SignInVM)ViewBag.SignIn,
        Header = "Вход",
        SubmitText = "Войти",
        AltActionText = "Нет аккаунта?\nПройдите регистрацию",
        AltControlID = REG_VID + "-link",
        FormID = LOGIN_VID,
        ControllerName = "Auth",
        ActionName = "Login",     
        FieldsViewName = "_Login"   
      })

      @await Html.PartialAsync("_GenericForm", new FormVM()
      {
        Item = (User)ViewBag.User,
        Header = "Регистрация",
        SubmitText = "Отправить",
        AltActionText = "Уже зарегистрированы?\nВойти",
        AltControlID = LOGIN_VID + "-link",
        FormID = REG_VID,
        ControllerName = "Auth",
        ActionName = "Register",     
        FieldsViewName = "_Register"   
      })

      <script>
        const LOGIN_FORM = document.getElementById('@LOGIN_VID');
        const REG_FORM = document.getElementById('@REG_VID');         
        const LINK_2LOGIN = document.getElementById('@LOGIN_VID' + '-link');
        const LINK_2REG = document.getElementById('@REG_VID' + '-link');

        function toggleForms(e, toShow, toHide) {
          e && e.preventDefault();
          toShow.removeAttribute('hidden');
          toHide.setAttribute('hidden', true);
        }

        if (@Json.Serialize(ViewBag.ShowLogin)) toggleForms(null, LOGIN_FORM, REG_FORM);
        else toggleForms(null, REG_FORM, LOGIN_FORM);

        LINK_2REG.addEventListener('click', function(e) {
          toggleForms(e, REG_FORM, LOGIN_FORM);
        });
        LINK_2LOGIN.addEventListener('click', function(e) {
          toggleForms(e, LOGIN_FORM, REG_FORM);
        });
      </script>

      @await Html.PartialAsync("_GenericForm", new FormVM()
      {
        Item = (Profile)ViewBag.Profile,
        Header = "Заполнение профиля",
        SubmitText = "Отправить",
        AltActionText = "Выйти",
        ControllerName = "Auth",
        ActionName = "Profile",     
        FieldsViewName = "_Profile"   
      })      
    </div>
  </div>
</body>
</html>